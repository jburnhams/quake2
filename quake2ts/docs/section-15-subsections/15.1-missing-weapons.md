# Section 15.1: Missing Weapons

**Priority**: P1 (base) / P3 (mission packs) | **Effort**: 3 weeks | **Parallel**: Yes

## Base Game

### Hand Grenade (Throwable)
- **Source**: `../rerelease/p_weapon.cpp:988-1213` (Throw_Generic function)
- **Priority**: HIGH - base game weapon
- **Current Status**: ~20% complete - Basic mechanics only, NO animation system
- **Blockers**: See **Section 15.0** for full details on missing foundational systems

#### What's Actually Implemented (Simplified Version)
- [x] Basic hold-to-cook timer mechanic (simplified, not frame-based)
- [x] Variable throw speed: 400-800 based on hold time
- [x] In-hand explosion if held too long (3+ sec)
- [x] Prime sound on first hold - **WRONG SOUND**: Using "hgrent1a.wav", should be "hgrena1b.wav" (frame 5)
- [x] Unit tests for basic mechanics - `tests/combat/hand_grenade.test.ts`

#### What's Missing (Blocked on 15.0 - Animation Systems)

**Critical Missing: Weapon Animation Framework** (15.0.2 - 2 weeks)
- [ ] Weapon state machine (WEAPON_ACTIVATING, READY, FIRING, DROPPING) - **COMPLETELY MISSING**
- [ ] Gun frame animation system (ps.gunframe) - **COMPLETELY MISSING**
- [ ] Throw_Generic() function with 48-frame animation sequence - **NOT IMPLEMENTED**
  - Frames 1-4: Prime animation lead-in
  - Frame 5 (FRAME_PRIME_SOUND): Prime sound "weapons/hgrena1b.wav"
  - Frames 6-10: Continue prime animation
  - Frame 11 (FRAME_THROW_HOLD): Hold frame - loops while button held
  - Frame 12 (FRAME_THROW_FIRE): Actual throw happens here
  - Frames 13-15: Follow-through animation
  - Frames 16-48: Idle animation with pause frames [29, 34, 39, 48]
- [ ] weapon_think_time animation timing system - **MISSING**
- [ ] Primed loop sound "weapons/hgrenc1b.wav" (plays via weapon_sound while held) - **MISSING**
- [ ] grenade_blew_up flag and proper state management - **MISSING**
- [ ] grenade_finished_time delay system - **MISSING**
- [ ] Death handling: Throw grenade if player dies while holding - **MISSING**
- [ ] Raise/lower animations when switching to/from grenade - **MISSING**

**P_ProjectSource System** (15.0.1 - 2 days)
- [ ] Proper throw origin from hand position (currently throws from player center)
- [ ] Angle limiting (prevent throw behind player)
- [ ] Wall trace prevention

**Player Body Animations** (15.0.3 - 1 week)
- [ ] Standing throw: FRAME_wave08→FRAME_wave01 (reversed animation)
- [ ] Crouching throw: FRAME_crattak1→FRAME_crattak3
- [ ] anim_priority system integration

#### Why Current Implementation is Incomplete

The current code has the **throw physics** working, but completely bypasses the **Quake II animation system**:

| Component | Original Quake II | Current quake2ts | Status |
|-----------|-------------------|------------------|--------|
| Throw mechanics | ✓ Frame-based in Throw_Generic | ✓ Simplified timer | Works but wrong architecture |
| Weapon animations | ✓ 48 frame sequence | ✗ None | MISSING |
| State machine | ✓ ACTIVATING/READY/FIRING | ✗ None | MISSING |
| Body animations | ✓ Throw gesture | ✗ None | MISSING |
| Sound integration | ✓ Frame-triggered sounds | ~ One-shot sound only | INCOMPLETE |
| Proper timing | ✓ Frame-based | ✗ Simplified polling | WRONG |

**This is like having a car engine that runs, but no transmission, steering, or wheels.**

#### Dependencies (Must Complete First)

1. **15.0.1**: P_ProjectSource System (2 days) - Fix weapon positioning
2. **15.0.2**: Weapon Animation System (2 weeks) - Implement Throw_Generic and state machine
3. **15.0.3**: Player Body Animations (1 week) - Add throw gestures

**Estimated Remaining Effort**: 3+ weeks (not the "just add animations" suggested by previous docs)

#### Testing Requirements (After 15.0 Complete)
- [ ] Weapon raise animation plays when switching to grenade
- [ ] Prime animation plays through frames 1-10
- [ ] Prime sound plays at frame 5 (not frame 1)
- [ ] Hold frame (11) loops smoothly while button held
- [ ] Primed loop sound plays continuously during hold
- [ ] Throw animation (frame 12) plays on release
- [ ] Grenade explodes in hand if held 3+ seconds
- [ ] Lower animation plays when switching away
- [ ] Player body shows throw gesture (different for ducking/standing)
- [ ] If player dies while holding, grenade is thrown

## Ground Zero (Rogue) - 6 Weapons

### Plasma Beam
- **Source**: `../rogue/p_rogue_weapon.cpp`
- [x] Continuous beam (like lightning gun)
- [x] Cell consumption per frame
- [x] Visual beam effect
- [x] Pushback on player

### Ion Ripper
- **Source**: `../rogue/g_rogue_weapon.cpp`
- [x] Spinning blade projectile
- [x] Bounces off walls (max 5 bounces)
- [x] Damage on each contact
- [x] Ricochet sound

### ETF Rifle
- **Source**: `../rogue/g_rogue_weapon.cpp`
- [x] Freeze ray (implemented as flechettes that apply freeze time)
- [x] Frozen enemies shatter on hit (implemented in T_Damage)
- [ ] Ice visual effect (Needs shader/skin support)
- [x] Temperature system (Basic freeze timer implemented)

### Phalanx
- **Source**: `../rogue/g_rogue_weapon.cpp`
- [x] Large plasma ball
- [x] Massive radius damage
- [x] Purple energy effect

### Prox Mine Launcher
- **Source**: `../rogue/g_rogue_weapon.cpp`
- [x] Fires sticky mines
- [x] Proximity trigger (enemy detection)
- [x] Laser tripwire beam - *Logic implemented (trace check), visual pending shader support*
- [x] Team-aware (doesn't trigger for owner)
- [x] Max 50 mines per player

### Chainfist
- **Source**: `../rogue/g_rogue_weapon.cpp`
- [ ] Chainsaw-style melee
- [ ] High close-range damage
- [ ] Continuous damage while held
- [ ] Gore effects

## Xatrix (The Reckoning) - 1 Weapon

### Trap
- **Source**: `../xatrix/g_xatrix_weapon.cpp`
- [ ] Deployable laser trap
- [ ] Damages enemies crossing beam
- [ ] Limited lifetime
- [ ] Visual laser effect

## Implementation Notes
- Hand grenade is only P1 (base game)
- Mission pack weapons are P3 (optional)
- Each weapon can be done independently
- Hand grenade estimated: 1 week
- Each mission pack weapon: 2-3 days
