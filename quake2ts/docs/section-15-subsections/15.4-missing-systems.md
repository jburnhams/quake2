# Section 15.4: Missing Game Systems

**Priority**: P1-P3 | **Effort**: ~6 weeks total | **Parallel**: Partial

## CRITICAL: Foundational Animation & Weapon Systems

**⚠️ See Section 15.0 for complete details on the most critical missing systems:**

- **15.0.1**: P_ProjectSource System (P0) - [x] **COMPLETED** (See 15.0)
- **15.0.2**: Weapon Animation System (P1) - [x] **COMPLETED** (See 15.0)
- **15.0.3**: Player Body Animation System (P2) - [x] **COMPLETED** (See 15.0)

**Section 15.0 provides full implementation details, testing requirements, and code structure.**

This section (15.4) documents **additional game systems** beyond the foundational ones in 15.0.

---

## Monster Sound System
- **Source**: All `m_*.cpp` files
- **Priority**: P2 - Polish
- **Effort**: 1 week

### Missing Features
- [x] Cached sound indices (performance) - *Implemented via `soundIndex` pre-caching in monsters*
- [x] Channel management (CHAN_VOICE, CHAN_WEAPON, CHAN_BODY) - *Consolidated in shared/audio/constants.ts and utilized in monster logic*
- [x] Attenuation types (ATTN_NORM, ATTN_IDLE, ATTN_STATIC) - *Consolidated in shared/audio/constants.ts and utilized in monster logic*
- [x] Frame-specific sound triggers - *Supported via frame `think` callbacks*
- [x] Footstep sounds on animation frames - *Implemented in Arachnid and others*
- [x] Weapon spin-up/down sounds - *Confirmed implemented in Gunner (gunatck1.wav), verified in test `gunner_sound.test.ts`*
- [x] Ambient idle sounds with random intervals - *Implemented in Infantry, Soldier, and Tank*

---

## Gibbing System Enhancements
- **Source**: `../rerelease/g_misc.cpp` ThrowGib
- **Priority**: P3 - Polish
- **Effort**: 3 days

### Missing
- [x] Specific gib models per body part
- [x] Gib type selection (head, arm, leg, torso)
- [x] Proper gib velocity/spin - *Verified deterministic implementation in `gibs.ts`*
- [x] Gib health (gibs can be shot)
- [x] Burn gibs (fire deaths) - *Implemented: prevents blood trails when damage mod is LAVA or TRAP, adds smoke effect (verified in `gibs.test.ts`)*
- [x] Mechanical gibs (robots) - *Implemented for Tank and Gunner (verified in `gibs-mechanical.test.ts`)*

---

## Advanced AI Systems

### Blindfire System
- **Source**: `../rerelease/g_ai.cpp`, monster implementations
- **Priority**: P3 - Advanced feature
- **Effort**: 1 week
- [x] AI_MANUAL_STEERING flag - *Implemented in `AIFlags` and utilized in `ai_run`/`ai_charge`.*
- [x] blind_fire_target tracking - *Implemented in `foundTarget`, `ai_run`, and `ai_charge`.*
- [x] M_AdjustBlindfireTarget - *Implemented in `entities/monsters/common.ts` and used by Tank.*
- [x] Shooting around corners - *Handled via `M_AdjustBlindfireTarget` offset checks.*
- [x] Suppressive fire - *Implemented via `M_CheckAttack` blind state logic.*

### Reinforcement System
- **Source**: `../rerelease/m_medic.cpp` (Commander)
- **Priority**: P2
- **Effort**: 3 days
- [x] Medic Commander spawns reinforcements - *Implemented in `medic.ts` via `medic_call_reinforcements` logic (verified in `medic-reinforcements.test.ts`).*
- [x] Reinforcement call animation - *Implemented via `call_reinforcements_move` frames (122-144).*
- [x] Monster type selection - *Implemented via `medic_pick_reinforcements` weighted logic.*
- [x] Cooldown system - *Implicit in animation duration and random chance logic.*

### Heat-Seeking Missiles
- **Source**: `../rerelease/g_weapon.cpp` monster_fire_heat
- **Priority**: P3
- **Effort**: 3 days
- [x] Target acquisition - *Implemented in `heatThink` with radius scan and DOT check.*
- [x] Turn rate limiting - *Implemented via `accel` parameter (turn_fraction).*
- [x] Loss of lock - *Implemented via FOV (DOT product) and line-of-sight checks.*
- [x] Used by Tank Commander, Supertank - *Integrated into `supertank.ts` and `tank.ts` via spawnflags (verified in `heat_seeking.test.ts` and `supertank-heat-seeking.test.ts`).*

---

## Difficulty Scaling
- **Source**: Throughout all files
- **Priority**: P2
- **Effort**: 1 week

### Missing
- [x] Monster health scaling per difficulty - **COMPLETED**
    - [x] Gunner, Gladiator, Tank, Supertank, Berserk, Infantry, Parasite, Flyer, Brain, Medic, Hover, Mutant, Chick, Flipper, Floater, Icarus
    - [x] Jorg, Makron, Boss2, Arachnid, Guardian, Fixbot, Gekk, Turret
- [x] Monster damage scaling - **COMPLETED** (Easy: 0.75x, Hard: 1.25x, Nightmare: 1.5x)
- [x] Monster accuracy adjustments - **COMPLETED** (Easy: 1.5x spread, Hard: 0.7x, Nightmare: 0.5x)
- [x] AI reaction time changes - *Implemented in `foundTarget` scaling logic based on skill setting.*
- [x] Pain suppression on nightmare - *Implemented in M_ShouldReactToPain check in common.ts*
- [x] Spawn filtering by difficulty flags

---

## Flashlight System (KEX)
- **Source**: KEX additions
- **Priority**: P4 - KEX feature
- **Effort**: 3 days
- [x] Toggleable flashlight - *Implemented via `cl_flashlight` CVar and command*
- [x] Battery/unlimited modes - *Implied unlimited for now (standard KEX behavior)*
- [x] Dynamic light attached to view - *Implemented in Client/Renderer with `RenderFx.Flashlight`*
- [x] trigger_flashlight control - *Implemented in `game` entities/triggers/flashlight.ts*

---

## Priority Summary

| System | Priority | Effort | Status |
|--------|----------|--------|---------|
| P_ProjectSource | P0 | 2 days | **DONE** (15.0) |
| Weapon Animation | P1 | 2 weeks | **DONE** (15.0) |
| Difficulty Scaling | P2 | 1 week | **DONE** |
| Player Animation | P2 | 1 week | **DONE** (15.0) |
| Monster Sounds | P2 | 1 week | **DONE** |
| Reinforcement | P2 | 3 days | **DONE** |
| Gibbing | P3 | 3 days | **COMPLETED** |
| Blindfire | P3 | 1 week | **COMPLETED** |
| Heat-Seeking | P3 | 3 days | **DONE** |
| Flashlight | P4 | 3 days | **DONE** |
