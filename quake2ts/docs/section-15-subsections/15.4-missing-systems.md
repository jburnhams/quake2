# Section 15.4: Missing Game Systems

**Priority**: P1-P2 | **Effort**: 4 weeks | **Parallel**: Partial

## Weapon Animation System
- **Source**: `../rerelease/p_weapon.cpp:878-1213`
- **Priority**: P1 - Core game feel
- **Effort**: 2 weeks

### Components
- [ ] Weapon state machine (ACTIVATING, READY, FIRING, DROPPING)
- [ ] Animation frame sequences (activate, fire, idle, deactivate)
- [ ] Pause frames for idle animations
- [ ] Fire frames (when shot actually fires)
- [ ] `Weapon_Generic()` (lines 878-950)
- [ ] `Weapon_Repeating()` (lines 952-978) for auto weapons
- [ ] `Throw_Generic()` (lines 1013-1213) for throwables
- [ ] Weapon chains (shotgunâ†’super shotgun)
- [ ] Auto-switch on empty ammo
- [ ] Instant weapon switch option

### Testing
- [ ] All weapons have raise/lower animations
- [ ] Idle animations with pause frames
- [ ] Fire timing matches original
- [ ] Weapon switching feels responsive

---

## Player Animation System
- **Source**: `../rerelease/p_client.cpp`, `p_view.cpp`
- **Priority**: P2 - Visual polish
- **Effort**: 1 week

### Components
- [ ] Body animations sync to actions
- [ ] Running (FRAME_run1-6)
- [ ] Standing attack (FRAME_attack1-8)
- [ ] Crouching attack (FRAME_crattak1-9)
- [ ] Pain animations (FRAME_pain1-4)
- [ ] Death animations (FRAME_death1-6)

---

## Monster Sound System
- **Source**: All `m_*.cpp` files
- **Priority**: P2 - Polish
- **Effort**: 1 week

### Missing Features
- [ ] Cached sound indices (performance)
- [ ] Channel management (CHAN_VOICE, CHAN_WEAPON, CHAN_BODY)
- [ ] Attenuation types (ATTN_NORM, ATTN_IDLE, ATTN_STATIC)
- [ ] Frame-specific sound triggers
- [ ] Footstep sounds on animation frames
- [ ] Weapon spin-up/down sounds
- [ ] Ambient idle sounds with random intervals

---

## Gibbing System Enhancements
- **Source**: `../rerelease/g_misc.cpp` ThrowGib
- **Priority**: P3 - Polish
- **Effort**: 3 days

### Missing
- [ ] Specific gib models per body part
- [ ] Gib type selection (head, arm, leg, torso)
- [ ] Proper gib velocity/spin
- [ ] Gib health (gibs can be shot)
- [ ] Burn gibs (fire deaths)
- [ ] Mechanical gibs (robots)

---

## Advanced AI Systems

### Blindfire System
- **Source**: `../rerelease/g_ai.cpp`, monster implementations
- **Priority**: P3 - Advanced feature
- **Effort**: 1 week
- [ ] AI_MANUAL_STEERING flag
- [ ] blind_fire_target tracking
- [ ] M_AdjustBlindfireTarget
- [ ] Shooting around corners
- [ ] Suppressive fire

### Reinforcement System
- **Source**: `../rerelease/m_medic.cpp` (Commander)
- **Priority**: P2
- **Effort**: 3 days
- [ ] Medic Commander spawns reinforcements
- [ ] Reinforcement call animation
- [ ] Monster type selection
- [ ] Cooldown system

### Heat-Seeking Missiles
- **Source**: `../rerelease/g_weapon.cpp` monster_fire_heat
- **Priority**: P3
- **Effort**: 3 days
- [ ] Target acquisition
- [ ] Turn rate limiting
- [ ] Loss of lock
- [ ] Used by Tank Commander, Supertank

---

## Difficulty Scaling
- **Source**: Throughout all files
- **Priority**: P2
- **Effort**: 1 week

### Missing
- [ ] Monster health scaling per difficulty
- [ ] Monster damage scaling
- [ ] Monster accuracy adjustments
- [ ] AI reaction time changes
- [ ] Pain suppression on nightmare
- [ ] Spawn filtering by difficulty flags

---

## P_ProjectSource System
- **Source**: `../rerelease/p_weapon.cpp:91-135`
- **Priority**: P0 - Critical for weapons
- **Effort**: 2 days

### Missing
- [ ] Eye position calculation (origin + viewheight)
- [ ] Weapon offset projection (forward/right/up)
- [ ] Left/right/center hand support
- [ ] Trace from eye to shot (prevent wall shots)
- [ ] Proper aim direction for railgun pierce

**Note**: Currently all shots fire from player origin, breaking railgun and allowing shots through walls

---

## Flashlight System (KEX)
- **Source**: KEX additions
- **Priority**: P4 - KEX feature
- **Effort**: 3 days
- [ ] Toggleable flashlight
- [ ] Battery/unlimited modes
- [ ] Dynamic light attached to view
- [ ] trigger_flashlight control

---

## Priority Summary

| System | Priority | Effort | Blocker |
|--------|----------|--------|---------|
| P_ProjectSource | P0 | 2 days | Weapons broken |
| Weapon Animation | P1 | 2 weeks | Core feel |
| Difficulty Scaling | P2 | 1 week | Balance |
| Player Animation | P2 | 1 week | Polish |
| Monster Sounds | P2 | 1 week | Polish |
| Reinforcement | P2 | 3 days | Medic feature |
| Gibbing | P3 | 3 days | Polish |
| Blindfire | P3 | 1 week | Advanced AI |
| Heat-Seeking | P3 | 3 days | Boss feature |
| Flashlight | P4 | 3 days | KEX only |

**Total P0-P2**: ~6 weeks
**Total P3-P4**: ~2 weeks
