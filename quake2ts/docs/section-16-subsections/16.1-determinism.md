# Section 16.1: Determinism Violations

**Priority**: P0 - **CRITICAL** | **Effort**: 2-3 days | **Parallel**: Yes

## Issue
18+ files use `Math.random()` → breaks save/load, testing, future multiplayer.

## Affected Files

**Monster AI** (15):
- [x] `monsters/flyer.ts:96`
- [x] `monsters/attack.ts:11`
- [x] `monsters/parasite.ts:42`
- [x] `monsters/jorg.ts:90,108,161,166,178`
- [x] `monsters/mutant.ts:41`
- [x] `monsters/chick.ts:42`
- [x] `monsters/soldier.ts:307,333`
- [x] `monsters/flipper.ts:31`
- [x] `monsters/makron.ts:90,197,208`
- [x] `monsters/boss2.ts:91,103,147`
- [x] `monsters/brain.ts:33`
- [x] `monsters/tank.ts:91,97,297`
- [x] `monsters/gunner.ts:75,119,239`
- [x] `monsters/supertank.ts:131,195,209`
- [x] `monsters/medic.ts:151`
- [x] `monsters/shambler.ts`
- [x] `monsters/arachnid.ts`
- [x] `monsters/gekk.ts`
- [x] `monsters/fixbot.ts`
- [x] `monsters/insane.ts`
- [x] `monsters/infantry.ts`
- [x] `monsters/rogue/stalker.ts`
- [x] `monsters/guardian.ts`
- [x] `monsters/gladiator.ts`
- [x] `monsters/gunnerCommander.ts`
- [x] `monsters/actor.ts`

**Utilities** (2):
- [x] `entities/utils.ts:57-59`
- [x] `engine/render/particleSystem.ts:65`
- [x] `entities/gibs.ts`
- [x] `entities/spawngro.ts`
- [x] `ai/monster.ts`
- [x] `combat/weapons/chainfist.ts`

**Placeholder helpers** (delete these):
- [x] Deleted local `random` helpers.

## Replacement Pattern

| Current | Replace With |
|---------|-------------|
| `Math.random()` | `game.random.frandom()` |
| `Math.random() - 0.5` | `game.random.crandom() / 2` |
| `(Math.random() - 0.5) * 2` | `game.random.crandom()` |
| `Math.floor(Math.random() * N)` | `game.random.irandom(0, N-1)` |

## Fix Process
- [x] Add `game: GameState` parameter to functions using random (Used `context.rng`)
- [x] Replace all `Math.random()` calls
- [x] Update all callers to pass `game` (context)
- [x] Delete placeholder `random()` helpers
- [x] Special case: ParticleSystem constructor needs `RandomGenerator` parameter

## Verification
```bash
# Must return ZERO results in modified files:
grep -r "Math\.random" packages/game/src/entities/monsters/ packages/game/src/entities/utils.ts packages/engine/src/render/particleSystem.ts
```

## Testing
- [x] All unit tests passed (updated to use mocked RNG).
- [ ] 10 runs with seed 12345 produce identical state hashes
- [ ] Save at frame 1000, load, continue → identical to not saving
- [x] All monster AI tests pass

**Source**: `../rerelease` uses MersenneTwister for deterministic RNG
